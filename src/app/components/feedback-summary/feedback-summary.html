<div class="feedback-summary">
  <div class="flex items-center justify-between mb-3">
    <h3 class="font-semibold text-gray-700">Correction Legend</h3>

    @if (activeFilter) {
    <button
      type="button"
      class="text-xs text-gray-500 hover:text-gray-700 underline"
      (click)="filterChange.emit(null)"
    >
      Clear filter
    </button>
    }
  </div>

  @if (!groups.length) {
  <div class="text-sm text-gray-500">No legend available.</div>
  } @else {
  <div class="space-y-3">
    @for (g of groups; track g.key) {
    <div class="legend-group">
      <button
        type="button"
        class="group-header w-full"
        [class.group-header-active]="isGroupActive(g.key)"
        (click)="onToggleGroup(g)"
      >
        <span class="flex items-center gap-2">
          <span
            class="color-swatch"
            [style.background]="toRgba(g.color, 0.45)"
            [style.border-color]="g.color || null"
          ></span>
          <span class="text-sm font-medium text-gray-700">{{ g.label }}</span>
        </span>

        <span class="text-xs text-gray-500">{{ g.totalCount }}</span>
      </button>

      <div class="mt-2 space-y-1">
        @for (s of g.symbols; track s.groupKey + '-' + s.symbol) {
        <button
          type="button"
          class="symbol-row w-full"
          [class.symbol-row-active]="isSymbolActive(s.groupKey, s.symbol)"
          (click)="onToggleSymbol(s)"
        >
          <span class="flex items-center gap-2 min-w-0">
            <span
              class="symbol-pill"
              [style.border-color]="s.groupColor || null"
              [style.background]="toRgba(s.groupColor, 0.18)"
            >
              {{ s.symbol }}
            </span>
            <span class="text-sm text-gray-600 truncate">{{ s.label }}</span>
          </span>

          <span class="text-xs text-gray-500">{{ s.count }}</span>
        </button>
        }
      </div>
    </div>
    }
  </div>
  }
</div>
