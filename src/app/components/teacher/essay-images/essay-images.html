<div class="max-w-4xl mx-auto p-4">
  <h2 class="text-xl font-semibold mb-4">Handwritten Essay — Corrections Overlay (English)</h2>

  <div class="relative bg-white rounded-lg shadow image-container overflow-hidden">
    <!-- replace with your own handwritten essay image -->
    <img
      [src]="imageUrl || 'img/sample.png'"
      alt="handwritten essay"
      class="w-full h-auto block select-none"
      draggable="false"
    />

    <!-- Loop through markers -->
    @for (m of markers; track m.id) {
    @if (m.bbox) {
    <div
      class="absolute z-20 pointer-events-none"
      [style.left.%]="m.bbox.x0"
      [style.top.%]="m.bbox.y0"
      [style.width.%]="m.bbox.x1 - m.bbox.x0"
      [style.height.%]="m.bbox.y1 - m.bbox.y0"
      [style.border-color]="m.bgColor || null"
      [style.background-color]="m.bgColor || null"
      style="border-width:2px; border-style:solid; opacity: 0.12;"
    ></div>
    }
    <!-- Marker button -->
    <button
      class="marker absolute -translate-x-1/2 -translate-y-1/2 w-9 h-9 rounded-full flex items-center justify-center ring-2 ring-white shadow-lg"
      [ngClass]="m.colorClass"
      [style.background-color]="m.bgColor || null"
      [style.color]="m.textColor || null"
      [style.left.%]="m.left"
      [style.top.%]="m.top"
      (click)="toggleTooltip(m)"
      (pointerdown)="startDrag($event, m)"
      (pointerup)="stopDrag($event)"
      [attr.aria-label]="m.short"
    >
      <span class="text-xs font-semibold">{{ m.symbol }}</span>
    </button>

    <!-- Tooltip -->
    @if (m.visible) {
    <div
      class="tooltip absolute z-40 max-w-xs p-3 bg-white border rounded-lg shadow-lg text-sm"
      [style.left.%]="m.left + 4"
      [style.top.%]="m.top"
    >
      <div class="flex items-start gap-2">
        <div class="flex-shrink-0">
          <div
            class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold"
            [ngClass]="m.colorClass"
            [style.background-color]="m.bgColor || null"
            [style.color]="m.textColor || null"
          >
            {{ m.symbol }}
          </div>
        </div>
        <div>
          <div class="font-semibold text-sm">{{ m.title }}</div>
          <div class="text-gray-700 text-xs mt-1">
            {{ m.description }}
          </div>
          <div class="text-xs text-gray-400 mt-2">Group: {{ m.group }}</div>
        </div>
      </div>
    </div>
    } }

    <!-- floating hint -->
    <div
      class="absolute right-3 bottom-3 bg-white/80 backdrop-blur-sm p-2 rounded-md text-xs border"
    >
      Click a marker to view correction • Mode:
      <span class="font-medium">{{ editMode ? 'Edit' : 'View' }}</span>
    </div>
  </div>

  <!-- controls -->
  <div class="mt-4 flex flex-wrap gap-2">
    <button class="px-3 py-2 bg-sky-600 text-white rounded shadow" (click)="toggleAll()">
      Toggle All Corrections
    </button>
    <button class="px-3 py-2 bg-gray-200 rounded" (click)="toggleEditMode()">
      {{ editMode ? 'Exit Edit Mode' : 'Enter Edit Mode (Drag markers)' }}
    </button>
    <button class="px-3 py-2 bg-rose-100 text-rose-800 rounded" (click)="resetToSample()">
      Reset Sample
    </button>
  </div>

  <p class="mt-3 text-sm text-gray-600">
    Note: Marker positions are saved to
    <code>localStorage</code>. Use edit mode to reposition markers for your image.
  </p>
</div>
